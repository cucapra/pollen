// Output is a (Segment, int) set.
outset out_degs[(Segment, int)];

for segment in in_g.segments {
  emit (segment, segment.edges.size()) to out_degs;
}